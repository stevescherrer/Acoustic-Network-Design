## Script for calculating means of the tag testing data
## 16.02.2013
rm(list=ls())
makehist <- function(data1,cases){
  ids <- unique(data1[,1])
  nid <- length(ids)
  d <- list()
  m <- list()
  sd <- list()
  if(nid==4) par(mfrow=c(2,2))
  for(i in 1:nid){
    d[[i]] <- data1[data1[,1]==ids[i],2]
    m[[i]] <- mean(d[[i]])
    sd[[i]] <- sqrt(var(d[[i]])/length(d[[i]]))
    ##hist(d[[i]],main=paste('id:',ids[i],'mean:',round(m[[i]],3),'sd:',round(sd[[i]],3)),xlab='Signal strength, dB')
    hist(d[[i]],main=paste(ids[i],cases[i],'. mean:',round(m[[i]],3),'nobs:',length(d[[i]])),xlab='Signal strength, dB')
  }
}

dat <- read.csv('VR100_10320_D2013.02.13T17.21.23.csv')

nn <- dim(dat)[1]
i <- 1
time <- as.POSIXct(paste(as.character(dat$Date[i]),as.character(dat$Time[i])),tz='UTC')
for(i in 2:nn) time[i] <- as.POSIXct(paste(as.character(dat$Date[i]),as.character(dat$Time[i])),tz='UTC')
##timeraw <- as.POSIXlt(time,tz='HST')
time <- as.POSIXlt(time,tz='UTC')
data <- dat


## --- Testing the effect of cases, trial 1
cases <- c('no case','s w holes','s wo holes','large')
strt <- as.POSIXct("2013-02-13 23:06:01",tz="UTC")
end <- as.POSIXct("2013-02-14 00:09:01",tz="UTC")
inds <- time>strt & time<end
time1 <- time[inds]
data1 <- data[inds,c(7,17)] ## Tag IDs and their signal strenght in dB
pdf('casesTrial1.pdf')
makehist(data1,cases)
dev.off()

## --- Testing the effect of cases, trial 2
cases <- c('no case','s w holes','s wo holes','large')
strt <- as.POSIXct("2013-02-14 00:09:11",tz="UTC")
end <- as.POSIXct("2013-02-14 01:11:01",tz="UTC")
inds <- time>strt & time<end
time2 <- time[inds]
data2 <- data[inds,c(7,17)] ## Tag IDs and their signal strenght in dB
pdf('casesTrial2.pdf')
makehist(data2,cases)
dev.off()

## --- Small collision test, 4 same tags half an hour
cases <- rep('no case',4)
strt <- as.POSIXct("2013-02-14 01:13:11",tz="UTC")
end <- as.POSIXct("2013-02-14 01:42:01",tz="UTC")
inds <- time>strt & time<end
time3 <- time[inds]
data3 <- data[inds,c(7,17)] ## Tag IDs and their signal strenght in dB
pdf('casesTrial3.pdf')
makehist(data3,cases)
dev.off()


